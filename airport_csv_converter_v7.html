<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Airport CSV to JSON (All Textareas)</title>
  <style>
    textarea {
      width: 32%;
      height: 300px;
      display: inline-block;
      vertical-align: top;
      font-family: monospace;
      font-size: 14px;
      padding: 8px;
      box-sizing: border-box;
      margin-right: 1%;
    }
    button {
      margin: 10px 0;
      font-size: 16px;
    }
  </style>
</head>
<body>
  <h2>ðŸ›« Airport CSV â†’ JSON Converter</h2>
  <button onclick="convert()">Convert & Deduplicate</button><br>

  <textarea id="csvInput" placeholder="âœï¸ Input CSV (can include IDENT,name,lat,lon,tz header)"></textarea>
  <textarea id="jsonOutput" placeholder="âœ… Output JSON will appear here"></textarea>
  <textarea id="dupeOutput" placeholder="âš ï¸ Duplicates (if any) will appear here"></textarea>

  <script>
    function convert() {
      const csv = document.getElementById("csvInput").value.trim();
      const lines = csv.split(/\r?\n/);
      const result = {};
      const duplicates = [];

      const dataLines = lines.filter((line, idx) => {
        if (idx === 0 && line.toLowerCase().includes("name") && line.toLowerCase().includes("lat")) {
          return false; // skip header
        }
        return true;
      });

      for (const line of dataLines) {
        const [icao, name, lat, lon, tz] = line.split(",");
        const key = icao?.trim().toUpperCase();
        if (!key || result[key]) {
          if (key) duplicates.push(key);
          continue;
        }
        result[key] = {
          name: name?.trim() || "",
          lat: parseFloat(lat),
          lon: parseFloat(lon),
          tz: tz?.trim() || "UTC"
        };
      }

      document.getElementById("jsonOutput").value = JSON.stringify(result, null, 2);
      document.getElementById("dupeOutput").value = duplicates.length
        ? duplicates.join("\n")
        : "âœ… No duplicates found.";
    }
  </script>
</body>
</html>
