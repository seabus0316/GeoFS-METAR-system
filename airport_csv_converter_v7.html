<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Airport CSV to JSON Converter (with Timezone & Duplicate Removal)</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    textarea { width: 48%; height: 200px; margin: 5px; white-space: pre; }
    .row { display: flex; justify-content: space-between; }
    button { padding: 10px 20px; margin: 10px 0; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/tz-lookup@6.1.24/tz.js"></script>
</head>
<body>
  <h2>‚úàÔ∏è Airport CSV ‚ûú JSON Converter (with Timezone & Duplicate Removal)</h2>
  <p>Paste your CSV here (format: ICAO,Name,Lat,Lon), first line should be header</p>
  <textarea id="csvInput" placeholder="Example:\nRCKH,Kaohsiung Intl,22.5769,120.351997\nRCQC,Magong Airport,23.5687,119.627998"></textarea>

  <button onclick="convertCSV()">üöÄ Convert ‚ûú JSON</button>

  <div class="row">
    <div>
      <h4>‚úÖ JSON Output:</h4>
      <textarea id="jsonOutput" readonly></textarea>
    </div>
    <div>
      <h4>‚ö†Ô∏è Duplicate ICAOs:</h4>
      <textarea id="duplicatesOutput" readonly></textarea>
    </div>
  </div>

  <script>
    async function convertCSV() {
      const csv = document.getElementById("csvInput").value.trim();
      const lines = csv.split(/\r?\n/);
      const json = {};
      const duplicates = [];

      for (let i = 1; i < lines.length; i++) {
        const [icaoRaw, nameRaw, latRaw, lonRaw] = lines[i].split(",");
        const icao = icaoRaw.trim().toUpperCase();

        if (json[icao]) {
          duplicates.push(icao);
          continue;
        }

        const lat = parseFloat(latRaw);
        const lon = parseFloat(lonRaw);
        const name = nameRaw.trim();

        let tz = "UTC";
        try {
          tz = tzlookup(lat, lon);
        } catch (e) {
          console.warn(`Timezone lookup failed for ${icao}`, e);
        }

        json[icao] = { name, lat, lon, tz };
      }

      document.getElementById("jsonOutput").value = JSON.stringify(json, null, 2);
      document.getElementById("duplicatesOutput").value = duplicates.join("\n");
    }
  </script>
</body>
</html>
